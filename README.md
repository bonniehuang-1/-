# 生产排产交付能力验证系统

一个基于Python的生产排产验证系统，用于分析生产计划能否满足交付要求，识别产能瓶颈和延期风险。

## 功能特点

- ✅ **多层级BOM展开**：自动计算各级半成品物料需求
- ✅ **产能排产计算**：基于日产能上限进行排产模拟
- ✅ **交付能力分析**：识别无法按时交付的订单
- ✅ **瓶颈识别**：找出产能瓶颈和缺口
- ✅ **Excel报告**：生成详细的分析报告和预警信息

## 系统要求

- Python 3.8 或更高版本
- Windows / Linux / macOS

## 安装步骤

### 1. 克隆或下载项目

```bash
cd production_scheduler
```

### 2. 安装依赖

```bash
pip install -r requirements.txt
```

### 3. 准备数据文件

在 `input/` 目录下准备以下3个Excel文件：

- `orders.xlsx` - 订单数据
- `bom.xlsx` - BOM物料清单
- `capacity.xlsx` - 产能数据

## 数据格式说明

### 订单数据 (orders.xlsx)

| 列名 | 类型 | 说明 | 示例 |
|------|------|------|------|
| 订单号 | 文本 | 订单唯一标识 | ORD-2024-001 |
| 产品型号 | 文本 | 成品型号 | PROD-A100 |
| 数量 | 整数 | 订单数量 | 1000 |
| 生产开工日期 | 日期 | 计划开工日期 | 2024-01-15 |
| 发货日期 | 日期 | 要求交付日期 | 2024-02-15 |

### BOM数据 (bom.xlsx)

| 列名 | 类型 | 说明 | 示例 |
|------|------|------|------|
| 父物料编码 | 文本 | 上级物料编码 | PROD-A100 |
| 子物料编码 | 文本 | 下级物料编码 | SEMI-B200 |
| 用量 | 小数 | 单位用量 | 2.5 |
| 层级 | 整数 | BOM层级 | 1 |
| 生产周期(天) | 整数 | 生产周期 | 3 |

### 产能数据 (capacity.xlsx)

| 列名 | 类型 | 说明 | 示例 |
|------|------|------|------|
| 物料编码 | 文本 | 物料编码 | SEMI-B200 |
| 日产能上限 | 整数 | 每日最大产能 | 500 |

## 使用方法

### 基本使用

```bash
python main.py
```

### 运行流程

系统将自动执行以下步骤：

1. **加载数据** - 读取并验证输入文件
2. **计算物料需求** - 根据BOM展开多层级需求
3. **执行排产** - 基于产能约束进行排产
4. **分析交付能力** - 对比预计完成时间与要求交付时间
5. **识别瓶颈** - 找出产能瓶颈物料
6. **生成报告** - 输出Excel分析报告

### 输出结果

报告文件位于 `output/` 目录：

- `delivery_analysis_report.xlsx` - 完整分析报告

报告包含以下工作表：

1. **交付能力总览** - 订单交付状态汇总
2. **延期订单明细** - 无法按时交付的订单详情
3. **产能缺口明细** - 具体缺口数量和比例
4. **瓶颈物料分析** - 瓶颈物料排名和影响分析

## 预警级别

- 🟢 **正常** - 可按时交付
- 🟡 **黄色预警** - 延期1-6天
- 🔴 **红色预警** - 延期7天以上

## 配置说明

编辑 `config.py` 可修改以下配置：

```python
# 工作日设置（0=周一, 6=周日）
WORK_DAYS = [0, 1, 2, 3, 4]  # 周一到周五

# 节假日列表
HOLIDAYS = ['2024-01-01', '2024-02-10']

# 预警阈值
ALERT_DELAY_DAYS_RED = 7     # 红色预警：延期>=7天
ALERT_DELAY_DAYS_YELLOW = 1  # 黄色预警：延期1-6天
```

## 项目结构

```
production_scheduler/
├── main.py                    # 主程序
├── config.py                  # 配置文件
├── requirements.txt           # 依赖清单
├── README.md                  # 本文件
│
├── data_loader/              # 数据加载模块
│   ├── order_loader.py
│   ├── bom_loader.py
│   └── capacity_loader.py
│
├── calculator/               # 计算引擎模块
│   ├── material_requirement.py  # MRP计算
│   └── production_scheduler.py  # 排产算法
│
├── analyzer/                 # 分析模块
│   ├── delivery_analyzer.py     # 交付分析
│   └── bottleneck_detector.py   # 瓶颈识别
│
├── reporter/                 # 报告生成模块
│   └── report_generator.py
│
├── utils/                    # 工具模块
│   ├── date_utils.py
│   └── validators.py
│
├── input/                    # 输入数据目录
│   ├── orders.xlsx
│   ├── bom.xlsx
│   └── capacity.xlsx
│
├── output/                   # 输出报告目录
│   └── delivery_analysis_report.xlsx
│
└── logs/                     # 日志目录
```

## 常见问题

### Q1: 如何处理多层级BOM？
系统会自动递归展开所有层级，无需手动处理。

### Q2: 如果某个物料没有产能数据怎么办？
系统会发出警告，该物料不参与排产计算，相关订单会标记为"无法排产"。

### Q3: 如何优化延期订单？
查看报告中的瓶颈物料，针对性提升该物料的产能，或调整订单优先级。

### Q4: 支持哪些日期格式？
支持Excel标准日期格式，如：2024-01-15、2024/01/15等。

### Q5: 如何处理节假日？
在 `config.py` 的 `HOLIDAYS` 列表中添加节假日期，系统会自动排除。

## 技术支持

如遇到问题，请检查：

1. Python版本是否>=3.8
2. 所有依赖是否已安装
3. 输入文件格式是否正确
4. 数据是否包含必填字段

查看 `logs/production_scheduler.log` 了解详细错误信息。

## 许可证

本项目仅供学习和内部使用。

## 更新日志

### v1.0.0 (2024-12-18)
- 初始版本发布
- 支持多层级BOM展开
- 支持产能排产计算
- 支持交付能力分析
- 支持瓶颈识别
- 支持Excel报告生成
