# 生产排产系统 - 用户使用指南

## 快速开始

### Windows用户

1. **双击运行** `run.bat` 文件
2. 系统会自动：
   - 检查Python环境
   - 安装必要的依赖
   - 生成示例数据（如果不存在）
   - 运行分析程序

### Linux/Mac用户

1. **打开终端**，进入项目目录
2. **添加执行权限**：
   ```bash
   chmod +x run.sh
   ```
3. **运行脚本**：
   ```bash
   ./run.sh
   ```

### 手动运行

```bash
# 1. 安装依赖
pip install -r requirements.txt

# 2. 生成示例数据（可选）
python create_sample_data.py

# 3. 运行主程序
python main.py
```

## 使用流程

### 第一步：准备数据文件

在 `input/` 目录下准备3个Excel文件：

#### 1. 订单数据 (orders.xlsx)

**必填列**：
- `订单号` - 订单唯一标识（文本）
- `产品型号` - 成品型号（文本）
- `数量` - 订单数量（整数）
- `生产开工日期` - 计划开工日期（日期格式：YYYY-MM-DD）
- `发货日期` - 要求交付日期（日期格式：YYYY-MM-DD）

**可选列**：
- `优先级` - 订单优先级（整数，默认5）
- `客户名称` - 客户名称（文本）
- `备注` - 备注信息（文本）

**示例**：
| 订单号 | 产品型号 | 数量 | 生产开工日期 | 发货日期 |
|--------|----------|------|--------------|----------|
| ORD-001 | PROD-A100 | 1000 | 2024-01-15 | 2024-02-15 |

#### 2. BOM数据 (bom.xlsx)

**必填列**：
- `父物料编码` - 上级物料编码（文本）
- `子物料编码` - 下级物料编码（文本）
- `用量` - 单位用量（小数）
- `层级` - BOM层级（整数，1表示一级半成品）
- `生产周期(天)` - 生产周期天数（整数）

**可选列**：
- `父物料名称` - 上级物料名称（文本）
- `子物料名称` - 下级物料名称（文本）
- `单位` - 计量单位（文本）

**示例**：
| 父物料编码 | 子物料编码 | 用量 | 层级 | 生产周期(天) |
|------------|------------|------|------|--------------|
| PROD-A100 | SEMI-X100 | 2.0 | 1 | 5 |

**注意事项**：
- 层级从1开始，数字越大表示越底层
- 不能存在循环引用（A→B→C→A）
- 父子物料不能相同

#### 3. 产能数据 (capacity.xlsx)

**必填列**：
- `物料编码` - 物料编码（文本）
- `日产能上限` - 每日最大产能（整数）

**可选列**：
- `物料名称` - 物料名称（文本）
- `产线/工序` - 产线或工序名称（文本）
- `生效日期` - 产能生效日期（日期）

**示例**：
| 物料编码 | 日产能上限 |
|----------|------------|
| SEMI-X100 | 400 |

**注意事项**：
- 所有BOM中的子物料都应该有对应的产能数据
- 如果物料编码重复，系统会保留第一条记录

### 第二步：运行系统

运行后，系统会自动执行以下步骤：

1. **加载数据** - 读取并验证输入文件
2. **计算物料需求** - 根据BOM展开多层级需求（MRP）
3. **执行排产** - 基于产能约束进行排产计算
4. **分析交付能力** - 对比预计完成时间与要求交付时间
5. **识别瓶颈** - 找出产能瓶颈物料
6. **生成报告** - 输出Excel分析报告

### 第三步：查看结果

#### 控制台输出

运行过程中会在控制台显示：
- 数据加载摘要
- 计算进度信息
- 关键预警信息
- TOP瓶颈物料

#### Excel报告

报告文件：`output/delivery_analysis_report.xlsx`

包含4个工作表：

1. **交付能力总览**
   - 汇总统计信息
   - 所有订单的交付状态
   - 按状态分类（正常/黄色预警/红色预警）

2. **延期订单明细**
   - 只显示延期的订单
   - 按延期天数降序排列
   - 显示瓶颈物料信息

3. **产能缺口明细**
   - 各物料的产能缺口数量
   - 缺口率百分比
   - 产能利用率

4. **瓶颈物料分析**
   - 瓶颈物料列表
   - 瓶颈类型（产能不足-延期/产能紧张）
   - 影响程度排名

## 结果解读

### 状态说明

- 🟢 **正常** - 可按时交付
- 🟡 **黄色预警** - 延期1-6天
- 🔴 **红色预警** - 延期7天以上

### 关键指标

1. **按时交付率** = 按时交付订单数 / 订单总数 × 100%
2. **产能利用率** = 实际生产量 / 日产能上限 × 100%
3. **缺口率** = 缺口数量 / 总需求量 × 100%

### 瓶颈类型

- **产能不足-延期** - 产能无法满足需求，导致延期
- **产能紧张** - 产能利用率超过90%，虽未延期但风险高

## 优化建议

### 如果出现延期订单

1. **查看瓶颈物料** - 在报告中找出导致延期的瓶颈物料
2. **提升产能** - 针对瓶颈物料增加产能（加班、外协、增加设备）
3. **调整优先级** - 优先保证重要订单
4. **协商交付日期** - 与客户沟通调整交付时间

### 如果产能利用率过高

1. **预留产能** - 避免满负荷运转，留有余量应对突发情况
2. **均衡排产** - 调整订单开工时间，避免产能集中
3. **长期规划** - 考虑扩大产能或优化工艺

## 配置调整

编辑 [`config.py`](production_scheduler/config.py) 可修改：

### 工作日设置

```python
# 0=周一, 1=周二, ..., 6=周日
WORK_DAYS = [0, 1, 2, 3, 4]  # 周一到周五
```

### 节假日设置

```python
HOLIDAYS = ['2024-01-01', '2024-02-10', '2024-05-01']
```

### 预警阈值

```python
ALERT_DELAY_DAYS_RED = 7     # 红色预警：延期>=7天
ALERT_DELAY_DAYS_YELLOW = 1  # 黄色预警：延期1-6天
CAPACITY_UTILIZATION_THRESHOLD = 0.9  # 产能利用率预警：90%
```

## 常见问题

### Q1: 提示"文件不存在"

**原因**：input目录下缺少数据文件

**解决**：
1. 运行 `python create_sample_data.py` 生成示例数据
2. 或手动创建3个Excel文件

### Q2: 提示"数据验证错误"

**原因**：数据格式不正确

**解决**：
1. 检查必填列是否完整
2. 检查数据类型是否正确（日期、数字等）
3. 检查日期逻辑（开工日期应早于交付日期）
4. 检查数量是否为正数

### Q3: 某些物料显示"无产能数据"

**原因**：BOM中的物料在产能表中找不到

**解决**：
1. 在capacity.xlsx中添加该物料的产能数据
2. 检查物料编码是否一致（注意空格）

### Q4: 所有订单都延期

**原因**：产能不足或生产周期过长

**解决**：
1. 增加产能上限
2. 提前开工日期
3. 延后交付日期
4. 优化生产周期

### Q5: 如何处理多个产线？

**当前版本**：同一物料的多个产线会合并为一条记录

**建议**：
1. 在产能表中只保留一条记录，日产能为所有产线之和
2. 或在"产线/工序"列中注明"产线1+产线2"

## 技术支持

### 查看日志

详细的运行日志保存在：`logs/production_scheduler.log`

### 错误排查

1. 检查Python版本：`python --version`（需要>=3.8）
2. 检查依赖安装：`pip list`
3. 查看错误堆栈信息
4. 检查数据文件格式

### 性能优化

- **大数据集**：如果订单或BOM记录超过10000条，可能需要几分钟
- **内存不足**：关闭其他程序，或分批处理订单

## 更新和维护

### 版本信息

当前版本：v1.0.0

### 未来功能

- [ ] 支持在制品库存
- [ ] 支持替代料和可选件
- [ ] 支持多工序产能约束
- [ ] Web界面
- [ ] 可视化甘特图

---

**祝您使用愉快！**

如有问题或建议，欢迎反馈。
